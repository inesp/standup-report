{% extends "base.html" %}

{% set header_before %}
  <!--- Timeframe selector -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
    <div class="flex items-center gap-4">
      <span class="font-medium text-gray-700">Show activity from last:</span>
      <div class="flex gap-2">
      {% set time_options = [
        (8, "8 hours"),
        (24, "24 hours"),
        (48, "48 hours"),
        (72, "3 days"),
        (168, "1 week"),
        (336, "2 weeks")
      ] %}
      {% for value, label in time_options %}
      <a href="/report/{{ value }}" 
         onclick="this.innerHTML = '<span class=\'inline-block animate-spin\'>â³</span> Loading...'; this.classList.add('opacity-50', 'cursor-wait')"
         class="px-3 py-1.5 rounded-md text-sm font-medium transition-colors
                {% if hours == value %}
                bg-blue-600 text-white hover:bg-blue-700
                {% else %}
                bg-gray-100 text-gray-700 hover:bg-gray-200
                {% endif %}">
        {{ label }}
      </a>
      {% endfor %}
      </div>
    </div>
  </div>
{% endset %}

{% block content %}
{% set pr_state_emoji = {'OPEN': 'â³', 'MERGED': 'ğŸš€', 'CLOSED': 'â›”'} %}
{% set review_emoji = {'APPROVED': 'âœ…', 'CHANGES_REQUESTED': 'ğŸ”„', 'REVIEW_REQUIRED': 'ğŸ§'} %}
{% set activity_emoji = {'CREATED': 'âœ¨', 'COMPLETED': 'ğŸ‰', 'WORKED_ON': 'ğŸ”¨', 'COMMENTED': 'ğŸ’¬', 'CANCELED': 'ğŸš«', 'UNKNOWN': 'â“'} %}

<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
  <div class="p-6">
    <h2 class="text-lg font-bold mb-3">Done</h2>
    <div class="mb-6">
      <!--- PRs --->
      {% for pr in my_latest_prs %}
        <p class="mb-1">
          {{ pr_state_emoji[pr.state] }}
          [{{ pr.repo_slug }}]
          {% if pr.state == 'MERGED' %}merged{% elif pr.created_at > since and pr.state != 'CLOSED' %} created{% else %}worked on{% endif %}
          PR <a href="{{ pr.url }}" class="text-blue-600 hover:underline">#{{ pr.number }} {{ pr.title }}</a>
        </p>
      {% endfor %}
      <!--- Issues --->
      {% for issue in my_linear_activity %}
        <p class="mb-1">
          {{ activity_emoji.get(issue.activity, 'â“') }}
          {{ issue.activity|lower|replace('_', ' ') }} issue
          <a href="{{ issue.url }}" class="text-blue-600 hover:underline">{{ issue.ident }} {{ issue.title }}</a>
          {% if issue.pr_attachments %}
            <span class="text-gray-500 text-sm">(PR{% if issue.pr_attachments|length > 1 %}s{% endif %}: {% for pr in issue.pr_attachments %}<a href="{{ pr.url }}" class="hover:underline">{{ pr.short_title }}</a>{% if not loop.last %}, {% endif %}{% endfor %})</span>
          {% endif %}
          <span class="text-gray-400">- {{ issue.last_change_ago }}</span>
        </p>
      {% endfor %}
    </div>

    <h2 class="text-lg font-bold mb-3">Next</h2>
    <div>
      {% for pr in my_open_prs %}
        <p class="mb-1">
          ğŸ”¨
          {% if pr.review_decision %}{{ review_emoji.get(pr.review_decision, '') }}{% endif %}
          [{{ pr.repo_slug }}]
          continue working on
          <a href="{{ pr.url }}" class="text-blue-600 hover:underline">PR #{{ pr.number }} {{ pr.title }}</a>
          <span class="text-gray-400">- {{ pr.last_change_ago }}</span>
          {% if pr.review_decision == 'REVIEW_REQUIRED' %}
          <span class="text-yellow-600 text-sm">(needs review)</span>
          {% endif %}
        </p>
      {% endfor %}
      {% for issue in my_in_progress_issues %}
        <p class="mb-1">
          ğŸ”¨
          TODO
        </p>
      {% endfor %}
    </div>
  </div>
</div>


{% endblock %}


