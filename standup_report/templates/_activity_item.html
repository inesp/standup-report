{% set ISSUE_ACTIVITY_CLASS_NAME = 'IssueActivity' %}
{% set PR_CLASS_NAME = 'PR' %}
{% set MEETING_CLASS_NAME = 'Meeting' %}

{% set pr_state_emoji = {'OPEN': '‚è≥', 'MERGED': 'üöÄ', 'CLOSED': '‚õî'} %}
{% set activity_emoji = {'CREATED': '‚ú®', 'COMPLETED': 'üéâ', 'WORKED_ON': 'üî®', 'COMMENTED': 'üí¨', 'CANCELED': 'üö´', 'UNKNOWN': '‚ùì'} %}

{# choose emoji #}
{% if item.__class__.__name__ == PR_CLASS_NAME %}
  {% set emoji = pr_state_emoji[item.state] %}
{% elif item.__class__.__name__ == ISSUE_ACTIVITY_CLASS_NAME %}
  {% set emoji = activity_emoji.get(item.activity, '‚ùì') %}
{% elif item.__class__.__name__ == MEETING_CLASS_NAME %}
  {% set emoji = 'üìÖ' %}
{% endif %}

{# choose item-class #}
{% if item.__class__.__name__ == ISSUE_ACTIVITY_CLASS_NAME and item.activity == 'CREATED' %}
  {% set item_class = "item-created-issue" %}
{% elif item.__class__.__name__ == MEETING_CLASS_NAME %}
  {% set item_class = "item-meeting" %}
{% else %}
  {% set item_class = "" %}
{% endif %}

<p class="mb-2 activity-item {{ item_class }}">

  {% include '_ignore_btn.html' %}

  {{ emoji }}

  {% if item.__class__.__name__ == PR_CLASS_NAME %}
    [{{ item.repo_slug }}]
    {% if item.state == 'MERGED' %}merged{% elif item.created_at > since and item.state != 'CLOSED' %}created{% else %}worked on{% endif %}
    PR
    {% with link_url=item.url, link_text="#" ~ item.number ~ " " ~ item.title %}{% include '_link_with_slack.html' %}{% endwith %}
  {% elif item.__class__.__name__ == ISSUE_ACTIVITY_CLASS_NAME %}
    {{ item.activity|lower|replace('_', ' ') }} issue
    {% with link_url=item.url, link_text=item.long_title %}{% include '_link_with_slack.html' %}{% endwith %}
    {% if item.pr_attachments %}
      <span class="text-gray-500 text-sm pr-attachments">(PR{% if item.pr_attachments|length > 1 %}s{% endif %}: {% for pr in item.pr_attachments %}{% with link_url=pr.url, link_text=pr.short_title %}{% include '_link_with_slack.html' %}{% endwith %}{% if not loop.last %}, {% endif %}{% endfor %})</span>
    {% endif %}
  {% elif item.__class__.__name__ == MEETING_CLASS_NAME %}
    <span class="text-gray-500 text-sm meeting-time hidden">[{{ item.start_time.strftime('%a %H:%M') }}]</span>
    meeting
    {% with link_url=item.url, link_text=item.title, link_title="Calendar " ~ item.calendar.title%}{% include '_link_with_slack.html' %}{% endwith %}
    {% if item.attendees %}
      <span class="text-gray-500 text-sm">with {% for att in item.attendees[:5] %}{{ att.split('@')[0] }}{% if not loop.last %}, {% endif %}{% endfor %}{% if item.attendees|length > 5 %}, ...{% endif %}</span>
    {% endif %}
  {% else %}
    Not implemented
  {% endif %}

  {% with note_category="done" %}{% include '_note_input.html' %}{% endwith %}

  <span class="text-gray-400 last-change-ago hidden">{{ item.last_change_ago }}</span>

</p>
